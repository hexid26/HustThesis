\chapter{基于用户移动特征的边缘服务部署}

% 摘要
随着智慧城市研究的深入，需要移动群智感知对城市中大量物理对象进行数字信息提取以提供数据支撑。
然而，城市中大量的移动设备通常跟随居民日常生活轨迹而移动，因此移动群智感知无法进行简单的区域划分来完成大面积覆盖的感知任务。
因此，研究者通常基于人类社交网络对感知任务进行部署，但对于感知数据的收集，并无过多讨论。
本章结合城市公交网络和城市居民的出行轨迹，利用 D2D 通信和边缘服务，设计了城市范围内低成本、高效率的感知数据收集模型。
基于此混合整数线性规划（Mixed Integer Linear Programming，简称 MILP）模型，提出了使感知成本最小化的边缘服务部署算法。
通过仿真测试，该算法得出部署成本与最优部署成本接近，收益远远高于基于乘客流量和交通站点连接度的部署方法。

\section{研究背景}

对于智慧城市应用，需要借助移动群智感知在全市范围内收集感知数据。
在面向城市范围的移动群智感知研究中，大多数研究者更倾向于提高感知任务的部署效率。
例如使用激励机制吸引用户主动参与感知任务~\cite{CNKI:JiaChaopeng, CNKI:WuMCSIncentive, jiyubianyuanjisuangongyecaiji}，或者利用用户的社交网络将感知任务快速分发给大量的移动设备~\cite{Cnki:Yu2018}。
文献~\cite{DBLP:journals/tii/TangCHPWHY17}还创建一个多层级的分布式边缘网络体系结构来执行数据表示和特征提取，并研究了城市范围内实施群智感知的可行性。
这些研究，从效率、能耗、成本等不同角度，对感知任务的部署提出了宝贵的优化意见。
然而，对于感知数据的收集工作，这些研究默认移动设备使用无线网络或者蜂窝网络直接进行感知数据交付。
此时，大量的移动设备直接将感知数据传回云端，不仅城域网会面对突发的网络负载，主干网也会因为海量的感知数据传输而发生阻塞。
Wang 等人~\cite{DBLP:conf/huc/WangZX13}利用 Bluetooth、WiFi 网关进行感知数据的上传，验证了延迟容忍的通信方式可以显著减少感知数据输出时的能耗和成本。
Karaliopoulos 等人~\cite{DBLP:conf/infocom/KaraliopoulosTK15} 在感知数据收集过程利用 D2D 通信，在感知任务的参与者中利用贪心算法选择小部分设备作为转发节点。但是这种决策方法的时间复杂度过高，并不适用于大规模的移动群智感知应用。
Wang 等人~\cite{DBLP:journals/puc/WangLL17}在上述工作中虽然做出了改进并提高了算法决策效率，但是需要收集大量的用户移动轨迹，基于用户的移动行为特征选择能够胜任 D2D 转发工作的移动设备来收集感知数据。
这些工作证明了 D2D 通信能够有效帮助移动群智感知应用减少数据收集时的能耗和成本，但是面对城市级的感知应用，仅仅依靠 D2D 通信和用户的移动行为特征还远远不够。

另一方面，利用边缘计算对群智感知的覆盖区域进行划分可以缓解这一问题，但是面对城市覆盖范围，需要部署的边缘服务数量过多也会导致成本的激增。
在不少智慧城市研究中，利用居民流向，建立了城市中吸引用户的兴趣点（Points of Interest，简称 POI）。
这些兴趣点在固定时间范围内，会产生大量的人流，因此居民的随身设备也会在此聚集、经过。
文献~\cite{DBLP:journals/iotj/ZhanXZW18}基于 POI 部署边缘服务进行感知数据的收集，发现在人流量高峰期时，可以达到不错的感知数据收集率。
利用不同种类的 POI，可以构建出不同种类的城市居民移动模型~\cite{CNKI:XiongOMCS}。
不同的城市居民移动模型，对移动群智感知的感知质量，存在着较大的影响。
例如基于游乐场、公园的移动模型，虽然 POI 上有很大的城市居民流量，但是对于单个居民而言，经过此类 POI 的规律并没有固定模式。
利用这一类移动模型，无法保障感知数据分布范围的稳定。
对于基于办公室、学校的移动模型，此类 POI 的城市居民个体行为相对稳定。
这也意味利用这些 POI 可以收集到的感知数据覆盖范围固定。
另一方面，由于此类 POI 容纳居民数量的限制，能够收集到的感知数量受居民数量影响而存在上限。

为了保障群智感知应用在城市范围内感知数据的空间分布稳定，并尽可能收集更多的感知数据，本章提出一种基于用户移动特征的边缘服务部署策略。
在城市中，绝大多数居民通常利用公共交通系统出行，例如公共汽车、地铁。
在工作日，居民出行的出发地与目的地相对固定，这种出行行为已经成为一种稳定的城市移动特征。
基于这一特征，可以利用公共交通站点，部署边缘服务，收集大量且分布稳定的感知数据。
同时，由于公共交通工具会在到站时有短暂的停靠时间，大量乘客在站点聚集，因此可以借助 D2D 通信，将感知数据直接交付给部署在公共交通站点上的边缘服务器。
采用这种做法，不仅可以减少蜂窝网络的使用，降低感知数据传输成本，还能避免主干网络资源的占用。
% 『因此，部分研究者提倡将基于交通网络构建城市居民的道路移动模型，作为在城市感知中部署边缘服务的依据，把感知数据的采集和处理服务迁移到合适的边缘服务器上~\cite{DBLP:journals/iotj/ZhanXZW18}。』


\begin{figure}[!h]
\centering
% \vspace{-1.5em}
\includegraphics[width=210pt]{figures/Sec_MONET/CPS.eps}
\vspace{-0.5em}
\caption{基于城市居民移动特征的城市感知\textbf{『需要重画』}}
% \vspace{-1em}
\label{Figure_edge}
\end{figure}

图~\ref{Figure_edge} 描述了基于公交网络的感知数据收集场景。
在城市中，部署有大量的传感器，城市居民的移动设备，可以作为这为传感器感知数据的携带者。
居民在使用公共交通出行时，会使用步行的方式或者自行车等交通工具移动到最近的公共交通站点。
此时，可以借助 D2D 通信收集收集途径传感器上的感知数据。
因此，同一路径上的居民可以收集同一区域不同时间点上的感知数据。
当居民进入公交站点，如果该站点已经部署有相应的边缘服务，则居民在等车的时候可以将感知数据上传到当前站点中的边缘服务器。
如果该站点没有部署边缘服务，居民作为公交乘客，当公交车在部署有边缘服务的公交车站停靠时，利用乘客上下车的时间空隙，通过 D2D 通信的方式将感知数据交付给边缘服务器。
对于沿途都没有经过部署有边缘服务站点的乘客，在群智感知应用生命周期的末期，再使用蜂窝网络上传感知数据。
基于这种感知数据上传策略，可以保障 D2D 通信的优先使用，以减少群智感知数据上传到成本。

基于上述感知数据收集方案，本章重点考虑生命周期有限的群智感知应用在城市感知范围内的边缘服务部署决策。
但是，对于城市中的公交路线，有大量的重复路径和交叉路径，因此 D2D 通信无法避免感知数据的重复上传。
另一方面，城市公交网络中，可以部署边缘服务的 POI 众多，在重复路径上部署边缘服务，反而导致成本的浪费。
因此，在该网络中部署边缘服务，需要针对居民的移动特征、重复路径、交叉路径做出合理的部署决策，以平衡蜂窝通信成本和边缘服务部署成本。
本章的主要贡献总结如下:

1）基于整个城市中公共交通乘客的流动模式，研究了低成本、高效益的边缘服务部署问题。

2）针对该问题建立了 MILP 模型，研究并解决了交叉路径下感知数据重复收集的问题。

3）针对 MILP 模型求解的高计算复杂度，提出了高性能的动态规划算法来求解边缘服务的部署决策。

实验结果表明，该算法能够很好地逼近最优解，优于其他竞争对手。

% 本文的其余部分组织如下。第2节介绍了边缘服务放置的相关工作。在第三节中介绍了系统模型。在第四节中，给出了成本最小化问题的MILP公式，并在第五节中提出了的启发式算法。第6节报告了绩效评估结果。最后，第7节结束了这项工作。


\section{问题描述}
\label{Sec_Monet_question}

本节针对基于公交网络的感知数据收集过程建立初步模型，并详细阐述了公交网络中重复路径和交叉路径对感知数据收集的影响。

\subsection{系统模型}

为了在城市范围内执行感知操作，部署传感网络灵活性低、改造成本高。
而使用蜂窝网络发送群智感知任务和感知数据，不仅提高了感知设备的门槛要求，也无形增加了感知数据传输的成本。
但是另一方面，城市中蜂窝基站的网络信号基本实现了城市范围的无死角覆盖。
为了让群智感知任务更好地部署在城市区域内，移动群智感知通常借助社交网络、社会网络等辅助感知任务的传播，将感知任务代码嵌入在用户社交信息中，随着社交活动的进行将感知任务扩散开。
但是，在感知数据的收集过程中，并没有研究人员借助社交网络或者社会网络来辅助数据回收，而是直接使用蜂窝基站作为了感知数据回收的代理节点。

在大城市中，为了方便居民的出行，公共交通网络的建设已经满足人口密集区域的全面覆盖。
并且随着城市规模的扩大，公共交通网络也会根据城市发展不断完善以覆盖新的区域。
而公共交通工具和公共交通站点，则是城市居民聚集的载体。
无论是乘客在公共交通站点等待车辆、还是公共交通工具在公共交通站点停靠，都会有若干分钟以上的时间将大量的居民聚集在小片区域内，足够使用 D2D 通信完成感知数据的交互。
因此，借助公共交通网络，可以利用乘客在交通工具中聚集时使用 D2D 通信收集乘客移动设备中的感知数据，从而避免对蜂窝网络通信的需求。
而城市居民的分布以及出行规律在工作日期间具备一定的稳定性，因此利用公共交通网络收集的感知数据也能保障其分布特征。
% 对于城市范围覆盖的移动群智感知应用，利用乘客的随身移动设备，不仅可以将感知任务部署到城市的边缘地带，也可以在乘客在交通工具中聚集时使用 D2D 通信将感知任务扩散。
因此，本章将公共交通站点作为 POI，通过在公共交通站点中部署边缘服务来收集感知数据、实施感知数据的预处理工作。

% 在本文中，考虑了公交车乘客参与拥挤的情况，他们可能会被转移到城市的不同地方。在基于公共汽车乘客的人群中，乘客负责收集从家里到公共汽车站的道路上的监控数据。不对传感数据采集施加任何限制。乘客可以通过从道路上专门部署的传感器收集感测数据或者通过嵌入智能手机中的传感器生成数据来获取数据。为了减轻基于基础设施的通信(例如蜂窝通信)的负担，提倡参与者尽可能使用设备对设备( D2D )通信。因此，D2D通信可能发生在乘客的智能手机和传感阶段专门部署的传感器之间。为了便于处理，假设乘客在感知阶段可以获得相同的数据量，用$s$表示。很容易将其扩展到不同乘客可以获取需要上传处理的大量数据的情况。


图~\ref{Figure_Wuhan_Buses} 所展示的是武汉市的公共交通网络，在这一交通网络中，日均乘客流量已经突破700万人次\footnote{武汉交通运输局 http://jyw.wuhan.gov.cn/Item/10002123.aspx}，公共交通站点超过2000个。
在如此庞大的交通网络中，如果每个站点都部署边缘服务来帮助群智感知的数据收集，其成本是难以想象的。
另一方面，不同公共交通站点的乘客流量可能存在较大的差异，因此在不同站点部署边缘服务的收益回报也不尽相同。
因此，需要筛选出合适的公共交通站点来部署边缘服务，用较少的边缘服务部署成本，尽可能利用庞大的乘客流量来收集感知数据。

\begin{figure}[!h]
  \centering
  % \vspace{-1.5em}
  \includegraphics[width=220pt]{figures/Sec_MONET/wuhan_bus.png}
  \vspace{-0.5em}
  \caption{武汉市交通网络}
  % \vspace{-1em}
  \label{Figure_Wuhan_Buses}
\end{figure}

为了更好地理解乘客在公共交通中的换成行为，在此将公共交通网络转化为有向图 $\boldsymbol{G}=<\boldsymbol{V}, \boldsymbol{E}>$。
在有向图 $\boldsymbol{G}$ 中，顶点 $v$（$v \in \boldsymbol{V}$） 表示公共交通站点，$\boldsymbol{E}$ 表示公交路线集合。
由于城市交通行为特征具有一定的稳定性~\cite{TAO201490}，尤其是在工作日、普通节假日时，乘客出行行为模式基本固定。
以工作日的城市交通行为特征为例，可以根据统计数据估计公交车站 $v$ 上的乘客到达率和离开率，分别表示为 $\lambda_v$ 和 $d_v$。
在没有特殊事件发生时， $\lambda_v$ 和 $d_v$ 通常趋于稳定。
假设站点 $v$ 部署了边缘服务进行感知数据的收集工作，在 $v$ 等待上车的乘客、途经的乘客（包括换成）、下车的乘客（已经到达终点，不再乘坐交通工具）均在站点有短暂的逗留时间，可以利用 D2D 通信收集这些常客移动设备里的感知数据。
因此，在站点 $v$ 部署边缘服务的收益，不仅和 $\lambda_v$ 、 $d_v$ 相关、也和途经站点 $v$ 的乘客流量相关。
但是，途经 $v$ 的乘客和在 $v$ 下车的乘客可能在之前的旅途中上传了感知数据，因此 $d_v$ 和途经站点 $v$ 的乘客流量并无法直接说明在站点 $v$ 部署边缘服务的收益。
这也是基于公交网络部署边缘服务时，边缘服务之间相互的影响关系。

% 由于在公共交通系统中，乘客可以被视为基于预定交通轨迹在站点之间移动，所以对于不同的两个车站 $u$ 和 $v$ 而言，从车站 $u$ 上车的乘客到车站 $v$ 的到达率用 $\lambda_{uv}$ 表示。

% 对于每一个公交车站 $v$ 而言，有三类乘客：等待上车的乘客、途经的乘客（包括换成）、下车的乘客（已经到达终点，不在乘坐交通工具）。
% 假设在 $v$ 部署边缘服务进行感知数据的收集工作，这三类乘客均在站点有短暂的逗留时间，则可以利用 D2D 通信收集这些常客移动设备里的感知数据。
% 若 $v$ 没有部署边缘服务，则等待上车的乘客只能在上车后，途径其它部署有边缘服务的站点时利用 D2D 通信上传感知数据。
% 对于途经站点 $v$ 的乘客，若之前没有途经部署有边缘服务的

% 注意，由于考虑了公交车线路规划和交通条件，在实际中$t_{uv}$不一定等于 $t_{vu}$。

\subsection{公交网络中边缘服务的相互影响关系}

\begin{figure}[!b]
  \centering
  % \vspace{-1em}
  \includegraphics[width=240pt]{figures/Sec_MONET/Puzzle.eps}
  % \vspace{-0.5em}
  \caption{公交统计信息示例}
  % \vspace{-1em}
  \label{Figure_puzzle}
\end{figure}

图~\ref{Figure_puzzle} 是一个简单的公交统计信息示例，用来说明公交网络中边缘服务的相互影响关系。
图中共有 5 个公交站点，每个公交站点均有上车人数和下车人数的统计信息。
同时，站与站的连接路径上也标明了改路径运输的乘客数量。
在该示例中，一共有2100名乘客参与了交通行为。
假设此时只选取一个站点部署边缘服务，显然只考虑乘客流量最多的1号站点，此时可以收集到来自1300名乘客的感知数据。
但是，如果可以选在两个站点部署边缘服务收集感知数据，该示例下最佳的选择方案是站点2和站点3。
此时，可以收集1900名乘客的感知数据，而站点2和站点1的部署方案，最多只能收集1800名乘客的感知数据，这些数据还是基于站点3到站点1的乘客中不包括来自站点2的乘客的前提。
可以看出，当站点2部署有边缘服务时，站点1作为其后序节点，其部署边缘服务的收益显著降低，而站点2到站点3的乘客较少，使此时站点3部署边缘服务的收益高于站点1。
当可以部署的边缘服务增加到三个时，该示例中最佳的部署方案又变成了站点5、站点3、和站点1的组合。
此时，2100名乘客的感知数据可以被全部收集完。

通过这个例子，可以发现当使用公交网络收集感知数据时，即使边缘服务的部署数量相同，不同部署方案的收益也各不相同。
并且，一个公交站点部署边缘服务的决策，会直接影响其后续可连通的站点的部署收益。
而这一影响的根本原因，就是乘客的路径上有多个车站部署了边缘服务，而当其经过第一个部署有边缘服务的车站时，感知数据已经上传。
在其后续旅途中，该乘客并不含有感知数据，对于后续部署有边缘服务的节点而言，此时的乘客流量并无法表示感知数据的可收集数量。
因此，当使用公交网络作为载体收集感知数据时，需要依据乘客移动特征考虑前置站点的边缘服务部署决策对后续站点可收集感知数据数量的影响。

\section{基于乘客移动特征的边缘服务部署模型与算法}

首先，将公交网络抽象为有向图 $\boldsymbol{G}=<\boldsymbol{V}, \boldsymbol{E}>$ 。
然后分析了乘客的流向与感知数据之间的关系，以及不同站点之间边缘部署决策的相互影响。
最后得出边缘服务部署决策、乘客乘车轨迹和数据采集成本之间的联系。
本节使用了表~\ref{table_notations_monet} 中定义的数学符号，其细节含义将在后文中解释。

\begin{table}[!t]
  \caption{数学符号及定义}
  \vspace{-1em}
  \label{table_notations_monet}
  \centering
  \begin{tabular}{|c|p{10.5cm}|}
    \hline
    \textbf{数学符号} & \textbf{定义}\\
    \hline
    $x_v$ & 是否在站点 $v$ 部署边缘服务\\\hline
    $c_v$ & 在站点 $v$ 部署边缘服务的成本\\\hline
    $C_v$ & 在公交网络中部署边缘服务的总成本\\\hline
    $c_c$ &  使用蜂窝网络上传感知数据的单价成本\\\hline
    $C_c$ &  使用蜂窝网络上传感知数据的总成本\\\hline
    $d_v^u$ & 从站点 $u$ 上车到站点 $v$ 下车的人数\\\hline
    $s$ & 一份感知数据的大小\\\hline
    $f_v^u$ & 从站点 $u$ 上车到站点 $v$ 下车的乘客携带的感知数据大小\\\hline
    $\lambda^u_{wv}$ & 从站点 $u$ 上车经过 $w$ 后再站点 $v$ 下车的乘客数量\\\hline
    $f_{wv}^u$ & 从站点 $u$ 上车经 $w$ 到站点 $v$ 下车的乘客携带的感知数据大小\\\hline
    $\lambdau$ & 在站点 $u$ 上车的乘客的到达率\\\hline
    % \hline
    % \hline
    % $\boldsymbol{U}$ & 由感知设备 $u$ 构成的集合\\\hline
    % $\boldsymbol{S}$ & 由主基站 $s$ 构成的集合\\\hline
    % $\boldsymbol{R}$ & 由 SDN 交换机 $r$ 构成的集合\\\hline
    % $\Lus$ & 感知设备$u$ 到主基站 $s$ 的链路 $\lus$ 构成的集合\\\hline
    % $\xu$ & 感知设备$u$是否使用计算任务卸载\\\hline
    % $\xus$ & 感知设备$u$的计算任务是否卸载到主基站$s$\\\hline
    % $\aus$ & 感知设备$u$的计算任务卸载到主基站$s$的比例\\\hline
    % $\xlus$ & $\lus$ 是否作为感知设备$u$ 到主基站 $s$ 的上行链路\\\hline
    % $\ylus$ & $\lus$ 是否作为感知设备$u$ 到主基站 $s$ 的下行链路\\\hline
    % $\Tlus$ & 链路$\lus$的传输时延\\\hline
    % $\Blus$ & 链路 $\lus$的带宽资源\\\hline
    % $\xrl$ & 链路 $\lus$ 是否经过SDN 交换机 $r$\\\hline
    % $\Bu$ & 感知设备 $u$的上行链路带宽需求\\\hline
    % $\Bd$ & 感知设备 $u$的下行链路带宽需求\\\hline
    % $\eu$ & 感知设备 $u$ 执行计算任务的能耗开销\\\hline
    % $\es$ & 主基站 $s$ 执行计算任务的能耗开销\\\hline
    % $\lambdau$ & 感知设备$u$上的计算任务到达率\\\hline
    % $\mu_u$ & 感知设备$u$的计算任务处理速度\\\hline
    % $\mu_s$ & 主基站$s$的计算任务处理速度\\\hline
    % % $\Tus$ & \\\hline
    % % $\Tsu$ & \\\hline
    % $T_{QoS}$ & 群智感知应用中计算任务远端执行时延阈值 \\\hline
  \end{tabular}
\end{table}

\subsection{面向乘客移动特征的边缘服务部署模型}

对于群智感知应用，一般都存在生命周期，既对感知数据的产生时间有范围要求，过早或太晚的数据，被认为是没有意义的感知数据。
因此，边缘服务的使用仅在群智感知应用的生命周期内。
由于感知质量的要求，群智感知应用需要尽可能地收集所有的感知数据。
基于这一初衷，本节假设在群智感知应用的生命周期内，边缘服务能够帮助群智感知利用 D2D 通信收集大部分的感知数据，剩余小部分的感知数据，则直接通过蜂窝网络上传。
这种策略既可以保障感知数据收集齐全，也能利用 D2D 通信减少感知数据的传输成本。
为了最大化利用 D2D 通信，意味着边缘服务的部署决策必须带来最多的收益，以减少感知数据的收集成本。

\textbf{（1） 部署成本}

首先，利用二进制变量 $x_v$ 表示站点 $v$ 上是否部署有边缘服务，其定义如式~\eqref{eq:xdefine}。

\begin{equation}
\label{eq:xdefine}
x_v =\left\{
\begin{aligned}
&1, \; 在站点 v 上部署边缘服务 (v\in \boldsymbol{V})\\
&0, \; 未在站点 v 上部署边缘服务 (v\in \boldsymbol{V})
\end{aligned}
\right.
\end{equation}

假设部署一个边缘服务的单位时间成本为 $c_v$，边缘服务部署总成本为$C_v$，在群智感知应用的生命周期 $T$ 内，在公交站点上部署边缘服务的总成本可以使用式~\eqref{eq:Cvcv} 进行计算。

\begin{equation}
\label{eq:Cvcv}
C_v = \sum_{v\in \boldsymbol{V}}x_v c_v T
\end{equation}

\textbf{（2） 前置站点部署边缘服务的影响}

为了获取站点 $v$ 部署边缘服务的可得收益，必须针对经过该站点的乘客路径考虑前置站点部署有边缘服务时所带来的影响。
假设站点 $u$ 是站点 $v$ 的前置站点，将在站点 $u$ 上车、在站点 $v$ 下车的乘客的人数记为$d^u_v$，且每名乘客的移动设备上含有一份感知数据，为简化处理，大小统一记为 $s$。
当这些乘客从站点 $u$ 到达站点 $v$ 时，这些乘客所携带的感知数据总大小用 $f^u_v$ 表示，由于每份感知数据的大小为 $s$。
则 $f^u_v$ 和 $d^u_v$ 的关系可以用式~\eqref{eq:FandD}表示。
当站点 $u$ 到 站点 $v$ 之间没有部署任何边缘服务时，表达式取等。
另一方面，站点 $u$ 到站点 $v$ 可能存在多条路径，如果只是其中一条路径上有站点部署有边缘服务，只会上传部分乘客的感知数据，导致 $f^u_v$ 小于 $d^u_v s$。

\begin{equation}
\label{eq:FandD}
f^u_v \leq d^u_v s, \quad \forall \ u, v\in \boldsymbol{V} (u \neq v)
\end{equation}

显然，式~\eqref{eq:FandD}并没有深入考虑站点 $u$ 到站点 $v$ 的多路径问题。
当站点 $u$ 和站点 $v$ 不是直接连通的站点时，用$w$表示站点 $u$ 和站点 $v$ 之间可连通的中间站点。
令$\lambda^u_{wv}$ 表示站点 $u$ 的乘客经由站点 $w$ 到达站点 $v$ 的乘客数量。
同样，以 $f^u_{wv}$ 表示这些乘客在到达站点 $v$ 时所携带的的感知数据大小，其关系如式~\eqref{eq:FandLambda}。

\begin{equation}
\label{eq:FandLambda}
f^u_{wv} \leq \lambda^u_{wv} s, \quad \forall \  u \in \boldsymbol{V}, v \in \boldsymbol{V}, w \in \boldsymbol{V}, u \neq v
\end{equation}

针对前置站点部署边缘服务对后续站点收集感知数据所产生的影响，这里先讨论任意非起点的站点 $v$。
当站点 $v$ 部署有数据收集服务时（$x_v = 1$），站点 $v$ 可以利用 D2D 通信收集所有经过的感知数据。
此时，站点 $v$ 所接收的流量来自三类乘客，从任意站点 $u$ 出发并在站点$v$ 下车的乘客；从任意站点 $u$ 出发经过站点$v$ 的乘客（当$v$是终点站时，途经乘客数量为0）；从站点$v$ 上车的乘客。
同时，由于所有流经的感知数据已经被站点 $v$ 接收，所以从站点 $v$ 流出的感知数据大小应该为 0。
当站点 $v$ 没有部署数据收集服务时（$x_v = 0$），站点 $v$ 不对经过的感知数据做任何处理。
因此进入站点 $v$ 的感知数据大小和流出站点 $v$ 的感知数据大小应当相同。
其中，流入的部分为从任意站点 $u$ 出发到达或经过站点$v$的乘客以及在站点$v$上车的乘客所携带的感知数据；流出的部分为在站点$v$ 下车、上车的乘客和途径站点$v$ （当$v$是终点站时，途经乘客数量为0）的乘客所携带的感知数据。
对这些关系进行整理，式~\eqref{eq:Vimpact}描述了站点 $v$ 是否部署边缘服务对后续站点的影响关系。

\begin{equation}
  \label{eq:Vimpact}
  %	d^u_v s (1-x_v)
    \sum_{x\in \boldsymbol{V}}f^u_{xv} (1-x_v) = f^u_v + \sum_{w\in \boldsymbol{V}}f^u_{vw}, \quad \forall \ u\in \boldsymbol{V}, v\in \boldsymbol{V}, u \neq v
\end{equation}

对于任何起始站点 $u$ 而言，令该站点来乘车的乘客到达率为$\lambda_u$。
如果在站点 $u$ 部署边缘服务进行感知工作的收集工作（$x_u = 1$），则从站点$u$出发的所有乘客都不会携带感知数据。
如果不在站点 $u$ 部署边缘服务进行感知工作的收集工作（$x_u = 0$），则所有从站点$u$出发的乘客都会携带感知数据。
因此是否部署边缘服务 $x_u$ 和它对后续站点的影响应当满足式~\eqref{eq:startU}。

\begin{equation}
\label{eq:startU}
\lambda_u s (1 - x_u) = \sum_{w\in \boldsymbol{V}}f^u_{uw}, \quad \forall \  u\in \boldsymbol{V}
\end{equation}

\textbf{（3） 边缘服务的收益}

在公交站点上部署边缘服务的核心目的，就是借助成本低廉的 D2D 通信来收集感知数据，以减少蜂窝网络的使用。
如果通过部署边缘服务，可以使 D2D 通信网络收集的感知数据更多，则表示边缘服务的收益越大。
因此，可以使用 D2D 通信收集到的感知数据大小来指代边缘服务的收益。
通过之前的模型定义以及对前置站点部署边缘服务的影响分析，通过 D2D 通信网络收集到的感知数据大小$V_{D2D}$可以用式~\eqref{Vd2d} 进行计算。

\begin{equation}
\label{Vd2d}
V_{D2D} = \sum_{v\in \boldsymbol{V}}(\sum_{u\in \boldsymbol{V}}\sum_{x\in \boldsymbol{V}}f^u_{xv} x_v + \lambda_v s x_v), \quad \forall \  u \neq v
\end{equation}

前文中，边缘服务的部署成本可以通过式~\eqref{eq:Cvcv} 得到。
因此，使用边缘服务收集感知数据的单价可以用$V_{D2D}/C_v$表示。
令蜂窝网络传输感知数据的单价成本为$c_c$，当$V_{D2D}/C_v < c_c$时，则说明部署边缘服务收集感知数据会带来正收益。

\subsection{优化目标}

由于只有部署边缘服务之后，乘客的移动设备才能使用 D2D 通信交付感知数据。
所以可以认为使用 D2D 通信收集感知数据的成本就是边缘服务的部署成本。
但是，仅仅依靠 D2D 通信并不能收集所有的感知设备。
为了保障感知数据的完整性，在此假设没有通过 D2D 通信交付的感知数据，会在感知应用生命周期结束之前直接利用蜂窝网络上传。
对于每个乘客而言，利用蜂窝网络上传感知数据的成本记为$c_c$。
因此，剩余感知数据使用蜂窝网络收集的成本$C_c$可以用式~\eqref{eq:c_m} 计算。

\begin{equation}
\label{eq:c_m}
C_c = \sum_{u\in \boldsymbol{V}}c_c(\lambda_u s - \sum_{v\in \boldsymbol{V}}(\sum_{u\in \boldsymbol{V}}\sum_{x\in \boldsymbol{V}}f^u_{xv} x_v + \lambda_v s x_v))T, \forall u \neq v
\end{equation}

对$C_c$ 和式~\eqref{eq:Cvcv} 中的$C_v$求和，可以得出基于公交网络的感知数据收集总成本。
再基于分析得到的限制条件和前置站点部署边缘服务的影响，在公交网络中的边缘服务部署决策可以转化为如式~\eqref{eq:MILP} 所描述的 MILP 问题求解。
由于 MILP 问题求解的高计算复杂度，本章针对这一问题提出了二阶段服务部署算法，利用动态规划的思想来快速求得接近最优解的部署方案。

% 现在，可以将成本最小化问题表述为
% \begin{equation}
% \min: \sum_{v\in \boldsymbol{V}}x_v c_vT+\sum_{u\in \boldsymbol{V}}c_c(\lambda_u - \max_{v\in \boldsymbol{V}} x_v \lambda'_{uv} s - \sum_{v\in \boldsymbol{V}}x_v d_{uv} s)T,\forall u \neq v
% \label{eq:origin_opt}
% \end{equation}

% 接下来，将上述优化问题线性化为混合整数线性规划（MILP），该规划通过引入辅助变量$f_{u} \leq \lambda'_{uv}, \forall u\in \boldsymbol{U}, v\in \boldsymbol{V}$形成。通过这样的定义，$f_u s$可以用来代替$\max_{v\in \boldsymbol{V}} x_v \lambda'_{uv} s$，以表示D2D可为首次到达公交车站$u$的乘客上传的最大数据速率。因此， 式~\eqref{eq:origin_opt}中的优化问题 可以等效地转换成以下形式:

\begin{equation}
\begin{aligned}
求最小值: &\quad \sum_{v\in \boldsymbol{V}}x_v c_vT \ + \\&\quad \sum_{u\in \boldsymbol{V}}c_c(\lambda_u s -  \lambda_u s x_u - \sum_{x\in \boldsymbol{V}}\sum_{v\in \boldsymbol{V}}f^u_{xv} x_v ))T, \forall u \neq v\\
\text{限制条件:} &\quad  f^u_v \leq d^u_v s, \forall u, v\in \boldsymbol{V}, u\neq v\\
% &\quad  f^u_v \geq d^u_v (1-x_v) s, \forall u, v\in V, u\neq v \\
&\quad f^u_{vw} \leq \lambda^u_{vw} s, \forall u \in \boldsymbol{V}, v \in \boldsymbol{V}, w \in \boldsymbol{V}, u \neq v\\
% &\quad f^u_{vw} \geq \lambda^u_{vw} (1-x_v) s, \forall u, v, w \in V,\\
&\quad \lambda_u s (1 - x_u) = \sum_{w\in \boldsymbol{V}}f^u_{uw}, \forall u\in \boldsymbol{V}, u \neq v\\
&\quad \sum_{x\in \boldsymbol{V}}f^u_{xv} (1-x_v) = f^u_v + \sum_{w\in \boldsymbol{V}}f^u_{vw}, \forall u\in \boldsymbol{V}, v\in \boldsymbol{V},u \neq v
%&\quad x_v \in \{0, 1\}, \forall v\in V
\end{aligned}
\label{eq:MILP}
\end{equation}

\subsection{二阶段边缘服务部署算法}

对于式~\eqref{eq:MILP} 所列出的 MILP 问题，虽然利用数学工具（例如 MATLAB、Gurobi）可以求出若干组最优解，但是求解复杂度过高，随着问题规模的扩大，求解时间呈指数级增长。
为此，本节设计了一种计算复杂度较低二阶段算法，来获得效果较好的次优解。

\textbf{第一阶段 （算法~\ref{algo_IP}）}:
在公共交通构成的有向图 $\boldsymbol{G}=<\boldsymbol{V}, \boldsymbol{E}>$ 中，单凭节点结合 $\boldsymbol{V}$ 和边集合 $\boldsymbol{E}$ 无法识别边缘服务的部署收益。
由于乘客在图中的轨迹在有向图 $\boldsymbol{G}$ 中以多个节点和边构成，所以需要依靠乘客的轨迹来确定站点是否合适部署边缘服务。
根据交通信息统计，可以获得每个乘客的乘车轨迹，借由这些轨迹可以确定感知数据在站点之间的移动顺序，以及众多感知数据的移动顺序是否存在重叠部分。
基于此，将路径划分并找出合适的站点部署边缘服务。

\begin{algorithm}[!b]
\setstretch{\algostretch}
% \KwIn{$\boldsymbol{P}$ : 乘客的路径集合}
\KwIn{$n$ 乘客总数}
\KwIn{$c_v$ 边缘服务部署成本}
\KwIn{$c_c$ 一份感知数据由蜂窝网络上传的成本}
\KwData{$\boldsymbol{P}$ 所有乘客的轨迹集合, $\boldsymbol{Stations}$ 所有车站集合 }
\For{$p \in P$}{
  \If {$p \not\in \boldsymbol{IP}$}{
    将路径 $p$ 加入集合$\boldsymbol{IP}$\\
    计使用 1 次
  }
  \Else{
    在 $\boldsymbol{IP}$ 中找到 p 的使用次数\\
    使用次数加 1
  }
}
\For{$s \in \boldsymbol{Stations}$}{
  \For{$p \in \boldsymbol{IP}$}{
    \If{$s \in p$}{
      在 $s$ 站点部署边缘服务收集感知数据的数量进行累加\\
      总和记为 $s.data$
    }
  }
  \If{$ s.data > c_v/c_c$}{
    把 $s$ 添加到 $\boldsymbol{ChoiceSet}$
  }
}
\KwOut{$\boldsymbol{ChoiceSet}$}
\caption{筛选可部署服务的站点集合 $\boldsymbol{ChoiceSet}$}
\label{algo_IP}
\end{algorithm}

在算法~\ref{algo_IP}中，另公共交通中的乘客总数为 $n$。
对于任一乘客 $i$ 而言，其移动的轨迹路径用 $p_i$ 表示。
因此，可以得到所有乘客的轨迹集合 $\boldsymbol{P}$（$p_i \in \boldsymbol{P}$）。
由于不同的乘客可能存在同样的轨迹，可以统计出每条路径 $p_i$ 上做经过的乘客数量。
将路径和其对应的乘客数量以键值对的形式保存在集合 $\boldsymbol{IP}$ （$(p_i, count) \in \boldsymbol{IP}$）中。
在不考虑边缘服务部署之间的影响时，集合 $\boldsymbol{IP}$ 可以很快得出在某一路径上部署边缘服务的感知数据收集总量。
同时，由于 $p_i$ 中包含该路径的站点信息，因此对于任意一个站点，也能快速计算仅在该站点部署边缘服务时的感知数据收集总量。

\begin{algorithm}[!b]
\setstretch{\algostretch}
\KwIn{$n$ : 乘客数量}
\KwIn{$\boldsymbol{IP}$ : 乘客的路径统计信息}
\KwIn{$\boldsymbol{ChoiceSet}$ : 可部署边缘服务的站点集合}
\KwIn{$c_c$: 一份感知数据由蜂窝网络上传的成本}
\KwIn{$c_v$: 边缘服务部署成本}
% \KwIn{$\es$ : 『解释说明』}
% \KwData{『输入数据』}
令 $s_{sum}$ 表示部署边缘服务的数量\\
令 $min_s$ 表示可部署边缘服务的最小数量\\
$min_s$ = $\boldsymbol{ChoiceSet}$元素个数和 $n \times c_c/c_v$ 中的最小值\\
令 $V_{D2D}$ 表示利用边缘服务能收集到的感知数据数量\\
令 $V_v$ 表示站点 $v$ 部署边缘服务后能收集到的感知数据数量\\
令 $P_v$ 表示 $\boldsymbol{IP}$ 中经过站点 $v$ 的路径个数\\
对 $\boldsymbol{IP}$ 中的站点按照 $V_v$/$P_v$ 的值从大到小排序\\
取出 $\boldsymbol{ChoiceSet}$ 中第一个站点\\
更新剩下站点可收集的感知数据数量，对 $\boldsymbol{ChoiceSet}$ 排序\\
令新的站点可接受感知数据数量为 $V'_v$\\
\While{$n - V_{D2D} > (c_v / c_c)$}{
  \While{$V'_v \leq (c_v / c_c)$}{
    \If {$\boldsymbol{ChoiceSet}$ 拥有一个以上的元素}{
      删掉当前 $\boldsymbol{ChoiceSet}$ 中首元素
    }
    \Else{
      回溯，撤销上一次选择
    }
  }
  \While{$V'_v > (c_v / c_c)$} {
    取出 $\boldsymbol{ChoiceSet}$ 中第一个站点\\
    更新剩下站点可收集的感知数据数量，对 $\boldsymbol{ChoiceSet}$ 排序\\
    令新的站点可接受感知数据数量为 $V'_v$\\
  }
}
\KwOut{站点选择集合}
\caption{找出合适的站点集合}
\label{algo_choice}
\end{algorithm}

由于边缘服务的部署成本为 $c_v$，一份感知数据借由蜂窝网络上传的成本是  $c_c$。
因此，若一个站点部署边缘服务之后利用 D2D 通信收集到的感知数据总数小于 $c_v/c_c$ 时，可以看做在该站点部署边缘服务的收益为负。
所以通过统计单个站点利用 D2D 收集的感知数据大小，来建立可选站点的集合 $\boldsymbol{ChoiceSet}$。

\textbf{第二阶段 （算法~\ref{algo_choice}）}:
在第一阶段算法中，集合 $\boldsymbol{ChoiceSet}$ 中记录的都为收益符合要求的站点。
因此，算法~\ref{algo_choice}的最终目标就是在集合 $\boldsymbol{ChoiceSet}$ 中找出合适的站点组合，使感知数据的收集总成本最小。
在最坏的情况下，所有的感知数据均使用蜂窝网络上传，此时对应的数据收集成本为 $c_c \cdot n$。
而引入边缘服务的宗旨，就是降低感知数据收集的成本开销。
因此，边缘服务的部署数量不应超过 $n\times c_c / c_v$。

同时，为了尽可能减少边缘服务部署决策之间的相互影响，这里优先使用被较少路径穿过、但乘客流量较大的站点。
由于这类站点只有少量路径经过，因此可以避免其部署边缘服务后，对其它站点部署收益的影响。
利用动态规划的思想，每次选择一个站点做为边缘服务的部署位置时，对后续的感知数据收集情况进行迭代运算，然后按照同样的方法对站点继续排序。
如此迭代下去，可以获得一组站点选择结合，作为边缘服务的部署参考。
但是，在满足边缘服务收集感知服务的收益同时，最后依赖蜂窝网络传输的数据量可能会大于 $c_v / c_c$。
此时，算法~\ref{algo_choice}进行回溯，寻找额外的解，通过次优组合寻找是否存在让更少的感知数据使用蜂窝网络上传的边缘服务部署方法。

\section{实验结果与分析}

为了回放乘客等车、乘车、转乘、上传数据等行为，本章实现了一个公共交通模拟平台（Bus Traffic Simulation Platform，简称 BSTP）。
通过对乘客轨迹的分析，利用二阶段边缘服务部署算法和其它方法生成边缘服务部署决策。
然后利用 BSTP 模拟不同部署策略的最终效果，以评估二阶段边缘服务部署算法。

\subsection{公共交通模拟平台（BSTP）}

BSTP 主要用来模拟城市中的公共交通行为，其主要输入数据可分为两部分。
一部分是城市的公共汽车时刻表，另一部分是每个乘客的路线。
从公共汽车时刻表中，可以得到所有公交汽车的过往路线、到达时间和出发间隔，并通过这些信息生成交通运输有向图。
输入的第二部分是每位乘客的路线，其中包含所有乘客的信息，每个乘客的起点站和终点站。
然而对于每位乘客，都有多条不同的路径来满足乘客的出行需求。
因此，在 BSTP 中对每位乘客构建一个可用乘车路线列表，然后按时间成本对该列表进行排序，使乘客可以优先选择时间成本最小的乘坐路线。

通过输入的两个部分数据，BTSP可以判断一辆公共汽车是否抵达车站。
当一辆公交车停靠在车站时，公交车上的乘客可以按照乘车计划下车或者转乘，而车站内等车的乘客则根据车辆是否满载以及乘车方案决定是否乘坐当前停靠的公交车辆。
与此同时，如果当前站点已经部署了边缘服务，公交车内、或者站台上的乘客可以在站点利用 D2D 通信上传感知数据。
通过 BTSP 模拟交通过程，可以统计出乘客的流量状态以及感知数据的传输状态。

\subsection{不同边缘服务部署策略的成本开销}

\begin{figure}[!b]
  \centering
  % \vspace{-1em}
  \includegraphics[width=300pt]{figures/Sec_MONET/test_bus_lines.png}
  \vspace{-0.5em}
  \caption{模拟测试中使用的公交路线}
  % \vspace{-1em}
  \label{Figure_test_bus_lines}
\end{figure}

在本实验中，按照武汉市的公共汽车时刻表选取了30条公交线路进行模拟测试。
公交线路图如图~\ref{Figure_test_bus_lines} 所示。
在 BSTP 模拟器中，这30条路线总共经过273个公交站点。
根据公共汽车时刻表的调度安排，在这30条公交路线上每小时有241辆公交车运营，每辆公交车的最大载人数设置为50人。
在模拟场景中，将移动群智感知应用的生命周期设为60分钟，而在公交车站上部署边缘服务的成本为每小时500（$c_v = 500$），而通过蜂窝网络上传一份感知数据的成本为1（$c_c = 1$）。

为了和本章提出的二阶段边缘服务部署决策算法（简称 2-Phases）对比，首先使用Gurobi~\footnote{https://www.gurobi.com} 对 MILP 模型进行求解，找出边缘服务的最佳放置解决方案。
然后构建了另外两种不同的边缘服务部署策略。
第一种部署策略以站点的乘客流量（Flow of People，简称 FoP）为优先级选择能产生收益的站点部署感知数据收集服务；
另一种部署策略是以站点的连接度（Connectivity of Station，简称 CoS）为优先级选择能产生收益的站点进行边缘服务的部署。

由于不同时段中，城市交通网络的负载并不相同，所以在使用 BSTP 进行模拟时，分别设置了乘客数量为5000、10000和50000的交通出行场景，以对应交通网络中轻载、中载、重载的不同状态。
通过对不同场景下的乘客轨迹进行分析，Gurobi、2-Phases、FoP、CoS 方法分别给出了不同的边缘服务部署方案。
将不同的部署方案在 BSTP 中模拟之后，可以得到具体的感知数据收集状态和感知数据收集总成本，其结果如表~\ref{table_monet_comp} 所示。

\begin{table}[!h]
\caption{不同决策方法所得部署方案与成本}
\vspace{-1em}
\label{table_monet_comp}
\centering
\begin{tabular}{|c|l|c|c|c|c|}
\hline
\multicolumn{1}{|l|}{\textbf{乘客总数量}} & \textbf{部署方法} & \multicolumn{1}{l|}{\textbf{边缘服务数量}} & \multicolumn{1}{l|}{\textbf{D2D 收集总量}} & \multicolumn{1}{l|}{\textbf{蜂窝收集总量}} & \multicolumn{1}{l|}{\textbf{总成本}} \\ \hline
\multirow{4}{*}{\textbf{\begin{tabular}[c]{@{}c@{}}5000\\ （轻载）\end{tabular}}}       & Gurobi        & 3                                    & 1798                                   & 3202                                 & 4702                              \\ \cline{2-6} 
                                      & 2-Phases      & 2                                    & 1269                                   & 3731                                 & 4731                              \\ \cline{2-6} 
                                      & FoP           & 3                                    & 1583                                   & 3417                                 & 4917                              \\ \cline{2-6} 
                                      & CoS           & 1                                    & 673                                    & 4327                                 & 4827                              \\ \hline
\multirow{4}{*}{\textbf{\begin{tabular}[c]{@{}c@{}}10000\\ （中载）\end{tabular}}}      & Gurobi        & 10                                   & 7576                                   & 2424                                 & 7424                              \\ \cline{2-6} 
                                      & 2-Phases      & 11                                   & 7852                                   & 2148                                 & 7648                              \\ \cline{2-6} 
                                      & FoP           & 12                                   & 7174                                   & 2826                                 & 8826                              \\ \cline{2-6} 
                                      & CoS           & 14                                   & 8093                                   & 1907                                 & 8907                              \\ \hline
\multirow{4}{*}{\textbf{\begin{tabular}[c]{@{}c@{}}50000\\ （重载）\end{tabular}}}      & Gurobi        & 27                                   & 28751                                  & 21249                                & 34749                             \\ \cline{2-6} 
                                      & 2-Phases      & 30                                   & 29714                                  & 20286                                & 35286                             \\ \cline{2-6} 
                                      & FoP           & 33                                   & 23897                                  & 26103                                & 42603                             \\ \cline{2-6} 
                                      & CoS           & 32                                   & 21638                                  & 28362                                & 44362                             \\ \hline
\end{tabular}
\end{table}

由于在测试中，蜂窝网络收集感知数据的单价成本$c_c$被设置为1，所以全部使用蜂窝网络收集感知数据的成本理应和交通网络中乘客的数量相同。
在表~\ref{table_monet_comp} 中，可以看出通过边缘服务，4种部署方法都能够有效降低感知数据的收集成本。
但是当交通网络处于轻载状态时，使用边缘服务收集感知数据的总成本依然与只使用蜂窝网络收集的成本相近。
当交通网络中的乘客增多时，边缘网络所带来的收益明显增加。
这与本文在章节~\ref{ISPA:结论} 中所得出的结论一样：在移动群智感知应用中使用 D2D 通信时，目标区域内移动设备的数量增加会显著提高感知质量、增加可收集的感知数据。

对于交通网络处于中载和重载两种情况，可以发现 FoP 方法和 CoS 方法部署了更多的边缘服务，但是相较于本章提出的 2\-Phases 算法和最优解，其利用 D2D 通信收集到的感知数据反而变少，导致成本的增加。
这一现象也与本文在章节~\ref{ISPA:结论} 中所得出的结论一样：在移动群智感知应用中使用边缘资源优化感知质量，首先应当提升边缘服务的工作效率，再考虑增加边缘服务的数量。

\begin{figure}[!b]
  \centering
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/cost5000.pdf}
    \label{fig_cost5000}
    \vspace{-2em}
    \caption{不同部署策略的数据s收集成本}
  \end{subfigure}
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/data5000.pdf}
    \label{fig_data5000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集数量}
  \end{subfigure}
    \vspace{-0.5em}
    \caption{5000 名乘客在 BSTP 中的模拟结果}
  \label{fig_5000}
\end{figure}

为了更直观的比较感知数据收集成本和两种网络收集感知数据的比例关系，图~\ref{fig_5000}、图~\ref{fig_10000} 和图~\ref{fig_50000} 分别展示了轻载、中载、重载三种情况下的数据收集成本以及 D2D 网络和蜂窝网络收集感知数据的数量比例。
在模拟测试中， $c_v = 500$ 且 $c_c = 1$，这意味着部署有边缘服务的站点必须接收500名乘客以上的感知数据，才能保证边缘服务的部署能够带来正收益。
对于轻载状态（图~\ref{fig_5000}）而言，由于乘客的分布疏散，很少有站点的乘客流量达到500。
再考虑到前置站点服务部署影响，所以能够保障边缘服务部署达到正收益的站点更加稀少，这也导致使用 D2D 收集的感知数据比例极低，4种部署方法的总成本也相对接近。


当交通状态处于中载时（图~\ref{fig_10000}），此时交通网络中的乘客都处于运动状态，为 D2D 通信创造了更多的机会。
虽然4种部署方法对于站点的选择以及边缘服务的部署数量都有不同的决策，但是相较于轻载状态而言，利用 D2D 收集的感知数据比例得到了显著的提升，至少有71.74\%的感知数据都经由 D2D 通信交付给边缘服务节点。
而本章提出 2\-Phases 部署决策算法，总能本仅仅比最优解高出3\%，比 FoP 和 CoS 部署方案分别节省 13.3\% 和 14.1\%的总成本。

\begin{figure}[!h]
  \centering
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/cost10000.pdf}
    \label{fig_cost10000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集成本}
  \end{subfigure}
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/data10000.pdf}
    \label{fig_data10000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集数量}
  \end{subfigure}
    \vspace{-0.5em}
    \caption{10000 名乘客在 BSTP 中的模拟结果}
  \label{fig_10000}
\end{figure}

\begin{figure}[!h]
  \centering
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/cost50000.pdf}
    \label{fig_cost50000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集成本}
  \end{subfigure}
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/data50000.pdf}
    \label{fig_data50000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集数量}
  \end{subfigure}
    \vspace{-0.5em}
    \caption{50000 名乘客在 BSTP 中的模拟结果}
  \label{fig_50000}
\end{figure}

当交通状态处于重载时（图~\ref{fig_50000}），虽然乘客的人数急剧增加，但是由于交通网络的承载量限制（241辆公交车，每辆公交车载客量为50人），绝大部分乘客都在车站处于等候状态。
因此，感知数据的流动性减弱，减少了 D2D 通信发生的概率，直接导致 D2D 通信可以收集的感知数据比例下降。
但是由于乘客密集度过大，使用最优部署和 2\-Phases 算法进行边缘服务部署，依然可以使用 D2D 通信接收57.5\%上的感知数据。
相较于最优解，2\-Phases 算法的感知数据收集成本上升了1.5\%，而且比 FoP 和 CoS 部署方法分别少17.1\%和20.4\%。

\section{本章小结}

本章主要研究了城市范围内的移动群智感知应用中的数据收集过程。
通过在公交车站部署边缘服务，利用城市居民的社会活动来完成感知数据的收集工作，以达到充分利用 D2D 通信，降低数据收集成本的目的。
本章围绕感知应用的生命周期、感知质量要求以及边缘服务部署策略，构建了 MILP 模型。
然后通过动态规划算法决定边缘服务的部署策略。
经仿真测试对比，该算法解决了交叉路径中感知数据的重复收集问题，提高 D2D 通信利用率并减少蜂窝网络通信的使用，降低了城市感知中数据收集的总成本。

