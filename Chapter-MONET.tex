\chapter{面向用户移动特征的边缘服务调度}

% 摘要
随着智慧城市研究的深入，需要移动群智感知对城市中大量物理对象进行数字信息提取以提供数据支撑。
然而，城市中的大量的移动设备通常跟随居民日常生活轨迹而移动，因此移动群智感知无法像无线传感网络进行简单的区域划分来完成感知任务。
因此，研究者通常基于人类社交网络对感知任务进行部署，但对于感知数据的收集，并无过多讨论。
本章结合城市公交网络和城市居民的出行轨迹，利用 D2D 通信和边缘服务，设计了城市范围内低成本、高效率的感知数据收集模型。
基于此混合整数线性规划（Mixed Integer Linear Programming，简称 MILP）模型，提出了使感知成本最小化的边缘服务部署算法。
通过仿真测试，该算法得出部署成本与最优部署成本接近，收益远远高于基于乘客流量和边缘服务连接度的部署方法。

\section{研究背景}

对于智慧城市应用，需要借助移动群智感知在全市范围内收集感知数据。
在面向城市范围的移动群智感知研究中，大多数研究者更倾向于提高感知任务的部署效率。
例如使用激励机制吸引用户主动参与感知任务~\cite{CNKI:JiaChaopeng, CNKI:WuMCSIncentive, jiyubianyuanjisuangongyecaiji}，或者利用用户的社交网络将感知任务快速分发给大量的移动设备~\cite{Cnki:Yu2018}。
文献~\cite{DBLP:journals/tii/TangCHPWHY17}还创建一个多层级的分布式边缘网络体系结构来执行数据表示和特征提取，并研究了城市范围内实施群智感知的可行性。
这些研究，从效率、能耗、成本等不同角度，对感知任务的部署提出了宝贵的优化意见。
然而，对于感知数据的收集工作，这些研究默认移动设备使用无线网络或者蜂窝网络直接进行感知数据交付。
此时，大量的移动设备直接将感知数据传回云端，不仅城域网会面对突发的网络负载，主干网也会因为海量的感知数据传输而发生阻塞。
Wang 等人~\cite{DBLP:conf/huc/WangZX13}利用 Bluetooth、WiFi 网关进行感知数据的上传，验证了延迟容忍的通信方式可以显著减少感知数据输出时的能耗和成本。
Karaliopoulos 等人~\cite{DBLP:conf/infocom/KaraliopoulosTK15} 在感知数据收集过程利用 D2D 通信，在感知任务的参与者中利用贪心算法选择小部分设备作为转发节点。但是这种决策方法的时间复杂度过高，并不适用于大规模的移动群智感知应用。
Wang 等人~\cite{DBLP:journals/puc/WangLL17}在上述工作中虽然做出了改进并提高了算法决策效率，但是需要收集大量的用户移动轨迹，基于用户的移动行为特征选择能够胜任 D2D 转发工作的移动设备来收集感知数据。
这些工作证明了 D2D 通信能够有效帮助移动群智感知应用减少数据收集时的能耗和成本，但是面对城市级的感知应用，仅仅依靠 D2D 通信和用户的移动行为特征还远远不够。

另一方面，利用边缘计算对群智感知的覆盖区域进行划分可以缓解这一问题，但是面对城市覆盖范围，需要部署的边缘服务数量过多也会导致成本的激增。
在不少智慧城市研究中，利用居民流向，建立了城市中吸引用户的兴趣点（Points of Interest，简称 POI）。
这些兴趣点在固定时间范围内，会产生大量的人流，因此居民的随身设备也会在此聚集、经过。
文献~\cite{DBLP:journals/iotj/ZhanXZW18}基于 POI 部署边缘服务进行感知数据的收集，发现在人流量高峰期时，可以达到不错的感知数据收集率。
利用不同种类的 POI，可以构建出不同种类的城市居民移动模型~\cite{CNKI:XiongOMCS}。
不同的城市居民移动模型，对移动群智感知的感知质量，存在着较大的影响。
例如基于游乐场、公园的移动模型，虽然 POI 上有很大的城市居民流量，但是对于单个居民而言，经过此类 POI 的规律并没有固定模式。
利用这一类移动模型，无法保障感知数据分布范围的稳定。
对于基于办公室、学校的移动模型，此类 POI 的城市居民个体行为相对稳定。
这也意味利用这些 POI 可以收集到的感知数据覆盖范围固定。
另一方面，由于此类 POI 容纳居民数量的限制，能够收集到的感知数量受居民数量影响而存在上限。

为了保障群智感知应用在城市范围内感知数据的空间分布稳定，并尽可能收集更多的感知数据，本章提出一种基于用户移动特征的边缘服务部署策略。
在城市中，绝大多数居民通常利用公共交通系统出行，例如公共汽车、地铁。
在工作日，居民出行的出发地与目的地相对固定，这种出行行为已经成为一种稳定的城市移动特征。
基于这一特征，可以利用公共交通站点，部署边缘服务，收集大量且分布稳定的感知数据。
同时，由于公共交通工具会在到站时有短暂的停靠时间，大量乘客在站点聚集，因此可以借助 D2D 通信，将感知数据直接交付给部署在公共交通站点上的边缘服务器。
采用这种做法，不仅可以减少蜂窝网络的使用，降低感知数据传输成本，还能避免主干网络资源的占用。
% 『因此，部分研究者提倡将基于交通网络构建城市居民的道路移动模型，作为在城市感知中部署边缘服务的依据，把感知数据的采集和处理服务迁移到合适的边缘服务器上~\cite{DBLP:journals/iotj/ZhanXZW18}。』


\begin{figure}[!h]
\centering
% \vspace{-1.5em}
\includegraphics[width=210pt]{figures/Sec_MONET/CPS.eps}
\vspace{-0.5em}
\caption{基于城市居民移动特征的城市感知\textbf{『需要重画』}}
% \vspace{-1em}
\label{Figure_edge}
\end{figure}

图~\ref{Figure_edge} 描述了基于公交网络的感知数据收集场景。
在城市中，部署有大量的传感器，城市居民的移动设备，可以作为这为传感器感知数据的携带者。
居民在使用公共交通出行时，会使用步行的方式或者自行车等交通工具移动到最近的公共交通站点。
此时，可以借助 D2D 通信收集收集途径传感器上的感知数据。
因此，同一路径上的居民可以收集同一区域不同时间点上的感知数据。
当居民进入公交站点，如果该站点已经部署有相应的边缘服务，则居民在等车的时候可以将感知数据上传到当前站点中的边缘服务器。
如果该站点没有部署边缘服务，居民作为公交乘客，当公交车在部署有边缘服务的公交车站停靠时，利用乘客上下车的时间空隙，通过 D2D 通信的方式将感知数据交付给边缘服务器。
对于沿途都没有经过部署有边缘服务站点的乘客，在群智感知应用生命周期的末期，再使用蜂窝网络上传感知数据。
基于这种感知数据上传策略，可以保障 D2D 通信的优先使用，以减少群智感知数据上传到成本。

基于上述感知数据收集方案，本章重点考虑生命周期有限的群智感知应用在城市感知范围内的边缘服务部署决策。
但是，对于城市中的公交路线，有大量的重复路径和交叉路径，因此 D2D 通信无法避免感知数据的重复上传。
另一方面，城市公交网络中，可以部署边缘服务的 POI 众多，在重复路径上部署边缘服务，反而导致成本的浪费。
因此，在该网络中部署边缘服务，需要针对居民的移动特征、重复路径、交叉路径做出合理的部署决策，以平衡蜂窝通信成本和边缘服务部署成本。
本章的主要贡献总结如下:

1）基于整个城市中公共交通乘客的流动模式，研究了低成本、高效益的边缘服务部署问题。

2）针对该问题建立了 MILP 模型，研究并解决了交叉路径下感知数据重复收集的问题。

3）针对 MILP 模型求解的高计算复杂度，提出了高性能的动态规划算法来求解边缘服务的部署决策。

实验结果表明，该算法能够很好地逼近最优解，优于其他竞争对手。

% 本文的其余部分组织如下。第2节介绍了边缘服务放置的相关工作。在第三节中介绍了系统模型。在第四节中，给出了成本最小化问题的MILP公式，并在第五节中提出了的启发式算法。第6节报告了绩效评估结果。最后，第7节结束了这项工作。


\section{问题描述}
\label{Sec_Monet_question}

本节针对基于公交网络的感知数据收集过程建立初步模型，并详细阐述了公交网络中重复路径和交叉路径对感知数据收集的影响。

\subsection{系统模型}

为了在城市范围内执行感知操作，部署传感网络灵活性低、改造成本高。
而使用蜂窝网络发送群智感知任务和感知数据，不仅提高了感知设备的门槛要求，也无形增加了感知数据传输的成本。
但是另一方面，城市中蜂窝基站的网络信号基本实现了城市范围的无死角覆盖。
为了让群智感知任务更好地部署在城市区域内，移动群智感知通常借助社交网络、社会网络等辅助感知任务的传播，将感知任务代码嵌入在用户社交信息中，随着社交活动的进行将感知任务扩散开。
但是，在感知数据的收集过程中，并没有研究人员借助社交网络或者社会网络来辅助数据回收，而是直接使用蜂窝基站作为了感知数据回收的代理节点。

在大城市中，为了方便居民的出行，公共交通网络的建设已经满足人口密集区域的全面覆盖。
并且随着城市规模的扩大，公共交通网络也会根据城市发展不断完善以覆盖新的区域。
而公共交通工具和公共交通站点，则是城市居民聚集的载体。
无论是乘客在公共交通站点等待车辆、还是公共交通工具在公共交通站点停靠，都会有若干分钟以上的时间将大量的居民聚集在小片区域内，足够使用 D2D 通信完成感知数据的交互。
因此，借助公共交通网络，可以利用乘客在交通工具中聚集时使用 D2D 通信收集乘客移动设备中的感知数据，从而避免对蜂窝网络通信的需求。
而城市居民的分布以及出行规律在工作日期间具备一定的稳定性，因此利用公共交通网络收集的感知数据也能保障其分布特征。
% 对于城市范围覆盖的移动群智感知应用，利用乘客的随身移动设备，不仅可以将感知任务部署到城市的边缘地带，也可以在乘客在交通工具中聚集时使用 D2D 通信将感知任务扩散。
因此，本章将公共交通站点作为 POI，通过在公共交通站点中部署边缘服务来收集感知数据、实施感知数据的预处理工作。

% 在本文中，考虑了公交车乘客参与拥挤的情况，他们可能会被转移到城市的不同地方。在基于公共汽车乘客的人群中，乘客负责收集从家里到公共汽车站的道路上的监控数据。不对传感数据采集施加任何限制。乘客可以通过从道路上专门部署的传感器收集感测数据或者通过嵌入智能手机中的传感器生成数据来获取数据。为了减轻基于基础设施的通信(例如蜂窝通信)的负担，提倡参与者尽可能使用设备对设备( D2D )通信。因此，D2D通信可能发生在乘客的智能手机和传感阶段专门部署的传感器之间。为了便于处理，假设乘客在感知阶段可以获得相同的数据量，用$s$表示。很容易将其扩展到不同乘客可以获取需要上传处理的大量数据的情况。


图~\ref{Figure_Wuhan_Buses} 所展示的是武汉市的公共交通网络，在这一交通网络中，日均乘客流量已经突破700万人次\footnote{武汉交通运输局 http://jyw.wuhan.gov.cn/Item/10002123.aspx}，公共交通站点超过2000个。
在如此庞大的交通网络中，如果每个站点都部署边缘服务来帮助群智感知的数据收集，其成本是难以想象的。
另一方面，不同公共交通站点的乘客流量可能存在较大的差异，因此在不同站点部署边缘服务的收益回报也不尽相同。
因此，需要筛选出合适的公共交通站点来部署边缘服务，用较少的边缘服务部署成本，尽可能利用庞大的乘客流量来收集感知数据。

\begin{figure}[!h]
  \centering
  % \vspace{-1.5em}
  \includegraphics[width=220pt]{figures/Sec_MONET/wuhan_bus.png}
  \vspace{-0.5em}
  \caption{武汉市交通网络}
  % \vspace{-1em}
  \label{Figure_Wuhan_Buses}
\end{figure}

为了更好地理解乘客在公共交通中的换成行为，在此将公共交通网络转化为有向图 $\boldsymbol{G}=<\boldsymbol{V}, \boldsymbol{E}>$。
在有向图 $\boldsymbol{G}$ 中，顶点 $v$（$v \in \boldsymbol{V}$） 表示公共交通站点，$\boldsymbol{E}$ 表示公交路线集合。
由于城市交通行为特征具有一定的稳定性~\cite{TAO201490}，尤其是在工作日、普通节假日时，乘客出行行为模式基本固定。
以工作日的城市交通行为特征为例，可以根据统计数据估计公交车站 $v$ 上的乘客到达率和离开率，分别表示为 $\lambda_v$ 和 $d_v$。
在没有特殊事件发生时， $\lambda_v$ 和 $d_v$ 通常趋于稳定。
假设站点 $v$ 部署了边缘服务进行感知数据的收集工作，在 $v$ 等待上车的乘客、途经的乘客（包括换成）、下车的乘客（已经到达终点，不再乘坐交通工具）均在站点有短暂的逗留时间，可以利用 D2D 通信收集这些常客移动设备里的感知数据。
因此，在站点 $v$ 部署边缘服务的收益，不仅和 $\lambda_v$ 、 $d_v$ 相关、也和途经站点 $v$ 的乘客流量相关。
但是，途经 $v$ 的乘客和在 $v$ 下车的乘客可能在之前的旅途中上传了感知数据，因此 $d_v$ 和途经站点 $v$ 的乘客流量并无法直接说明在站点 $v$ 部署边缘服务的收益。
这也是基于公交网络部署边缘服务时，边缘服务之间相互的影响关系。

% 由于在公共交通系统中，乘客可以被视为基于预定交通轨迹在站点之间移动，所以对于不同的两个车站 $u$ 和 $v$ 而言，从车站 $u$ 上车的乘客到车站 $v$ 的到达率用 $\lambda_{uv}$ 表示。

% 对于每一个公交车站 $v$ 而言，有三类乘客：等待上车的乘客、途经的乘客（包括换成）、下车的乘客（已经到达终点，不在乘坐交通工具）。
% 假设在 $v$ 部署边缘服务进行感知数据的收集工作，这三类乘客均在站点有短暂的逗留时间，则可以利用 D2D 通信收集这些常客移动设备里的感知数据。
% 若 $v$ 没有部署边缘服务，则等待上车的乘客只能在上车后，途径其它部署有边缘服务的站点时利用 D2D 通信上传感知数据。
% 对于途经站点 $v$ 的乘客，若之前没有途经部署有边缘服务的

% 注意，由于考虑了公交车线路规划和交通条件，在实际中$t_{uv}$不一定等于 $t_{vu}$。

\subsection{公交网络中边缘服务的相互影响关系}

\begin{figure}[!b]
  \centering
  % \vspace{-1em}
  \includegraphics[width=210pt]{figures/Sec_MONET/Puzzle.eps}
  % \vspace{-0.5em}
  \caption{公交统计信息示例}
  % \vspace{-1em}
  \label{Figure_puzzle}
\end{figure}

图~\ref{Figure_puzzle} 是一个简单的公交统计信息示例，用来说明公交网络中边缘服务的相互影响关系。
图中共有 5 个公交站点，每个公交站点均有上车人数和下车人数的统计信息。
同时，站与站的连接路径上也标明了改路径运输的乘客数量。
在该示例中，一共有2100名乘客参与了交通行为。
假设此时只选取一个站点部署边缘服务，显然只考虑乘客流量最多的1号站点，此时可以收集到来自1300名乘客的感知数据。
但是，如果可以选在两个站点部署边缘服务收集感知数据，该示例下最佳的选择方案是站点2和站点3。
此时，可以收集1900名乘客的感知数据，而站点2和站点1的部署方案，最多只能收集1800名乘客的感知数据，这些数据还是基于站点3到站点1的乘客中不包括来自站点2的乘客的前提。
可以看出，当站点2部署有边缘服务时，站点1作为其后序节点，其部署边缘服务的收益显著降低，而站点2到站点3的乘客较少，使此时站点3部署边缘服务的收益高于站点1。
当可以部署的边缘服务增加到三个时，该示例中最佳的部署方案又变成了站点5、站点3、和站点1的组合。
此时，2100名乘客的感知数据可以被全部收集完。

通过这个例子，可以发现当使用公交网络收集感知数据时，不同部署方案的收益各不相同。
并且，一个公交站点部署边缘服务的决策，会直接影响其后续可连通的站点的部署收益。
而这一影响的根本原因，就是乘客的路径上有多个车站部署了边缘服务，而当其经过第一个部署有边缘服务的车站时，感知数据已经上传。
在其后续旅途中，该乘客并不含有感知数据，对于后续部署有边缘服务的节点而言，此时的乘客流量并无法表示感知数据的可收集数量。
因此，当使用公交网络作为载体收集感知数据时，需要面将乘客移动特征建立边缘服务部署策略。

\section{面向乘客移动特征的边缘服务部署模型与算法}

上一小节中使用了 $\boldsymbol{G}=<\boldsymbol{V}, \boldsymbol{E}>$ 将公交网络抽象为有向图。为了在有向图 $\boldsymbol{G}$ 中选择合适的站点 $v$ 部署边缘服务来收集感知数据，需要根据乘客的轨迹来确定站点 $v$ 部署边缘服务的收益。

\subsection{面向乘客移动特征的边缘服务部署模型}

对于群智感知应用而言，一般都存在生命周期，既对感知数据的产生时间有范围要求，过早或太晚的数据，被认为是没有意义的感知数据。
因此，边缘服务的使用仅在群智感知应用的生命周期内。
由于感知质量的要求，群智感知应用需要尽可能地收集所有的感知数据。
基于这一初衷，本节假设在群智感知应用的生命周期内，边缘服务能够帮助群智感知利用 D2D 通信收集大部分的感知数据，剩余小部分的感知数据，则直接通过蜂窝网络上传。
这种策略既可以保障感知数据收集齐全，也能利用 D2D 通信减少感知数据的传输成本。
为了最大化利用 D2D 通信，意味着边缘服务的部署决策必须带来最多的收益。

\textbf{（1） 部署成本}

在此，利用二进制变量 $x_v$ 表示站点 $v$ 上是否部署有边缘服务，其定义如式~\eqref{eq:xdefine}。

\begin{equation}
\label{eq:xdefine}
x_v =\left\{
\begin{aligned}
&1, \; 在 v 上部署边缘服务 (v\in \boldsymbol{V})\\
&0, \; 未在 v 上部署边缘服务 (v\in \boldsymbol{V})
\end{aligned}
\right.
\end{equation}

假设部署一个边缘服务的单位时间成本固定为 $c_v$，边缘服务部署总成本为$C_v$，在群智感知应用的生命周期 $T$ 内，其关系如式~\eqref{eq:Cvcv} 所表达。

\begin{equation}
\label{eq:Cvcv}
C_v = \sum_{v\in \boldsymbol{V}}x_v c_v T
\end{equation}

\textbf{（2） 前置站点部署边缘服务的影响}

为了获取站点 $v$ 部署边缘服务的可得收益，必须针对经过该站点的乘客路径考虑前置站点部署有边缘服务时所带来的影响。
假设站点 $u$ 是站点 $v$ 的前置站点，将在站点 $u$ 上车、在站点 $v$ 下车的乘客的人数记为$d^u_v$，且每名乘客的移动设备上含有一份感知数据，为简化处理，大小统一记为 $s$。
当这些乘客从站点 $u$ 到达站点 $v$ 时，这些乘客所携带的感知数据总大小用 $f^u_v$ 表示，由于每份感知数据的大小为 $s$。
则 $f^u_v$ 和 $d^u_v$ 的关系可以用式~\eqref{eq:FandD}表示。
当站点 $u$ 到 站点 $v$ 之间没有部署任何边缘服务时，表达式取等。
另一方面，站点 $u$ 到站点 $v$ 可能存在多条路径，如果只是其中一条路径上有站点部署有边缘服务，只会上传部分乘客的感知数据，导致 $f^u_v$ 小于 $d^u_v s$。

\begin{equation}
\label{eq:FandD}
f^u_v \leq d^u_v s, \forall u, v\in \boldsymbol{V} (u \neq v)
\end{equation}

显然，式~\eqref{eq:FandD}并没有深入考虑站点 $u$ 到站点 $v$ 的多路径问题。
在此，假定站点 $u$ 和站点 $v$ 之间存在可连通的站点 $w$。
$\lambda^u_{wv}$ 表示站点 $u$ 的乘客经由站点 $w$ 到达站点 $v$ 的乘客数量。
同理，以 $f^u_{wv}$ 表示这些乘客在到达站点 $v$ 时的感知数据大小，其关系如式~\eqref{eq:FandLambda}。

\begin{equation}
\label{eq:FandLambda}
f^u_{wv} \leq \lambda^u_{wv} s, \forall u \in \boldsymbol{V}, v \in \boldsymbol{V}, w \in \boldsymbol{V}, u \neq v
\end{equation}

以站点 $u$ 作为起始站，对于站点 $v$ 而言，是否部署边缘服务会直接影响其后续站点的可收集感知数据数量。
当 $x_v =1$ 时，站点 $v$ 部署有边缘服务利用 D2D 通信吸收了途经的所有感知数据。
此时，以站点 $v$ 作为出发点，其后续站点来自站点 $v$ 的感知数据大小都为 0。
当 $x_v =0$ 时，进入站点 $v$ 的感知数据，被分成两个流向，一部分被在站点 $v$ 下车的乘客带走，另一部分传递给后续的站点。
式~\eqref{eq:Vimpact}描述了站点 $v$ 是否部署边缘服务的影响关系。

\begin{equation}
  \label{eq:Vimpact}
  %	d^u_v s (1-x_v)
    \sum_{x\in \boldsymbol{V}}f^u_{xv} (1-x_v) = f^u_v + \sum_{w\in \boldsymbol{V}}f^u_{vw}, \forall u\in \boldsymbol{V}, v\in \boldsymbol{V}, u \neq v
\end{equation}

同样，对于任何站点 $u$ 而言，都有乘客上车，因此是否部署边缘服务 $x_u$ 和它对后续站点的影响应当满足式~\eqref{eq:startU}。
式中，$\lambda_u$ 表示在站点 $u$ 上车的乘客数量。
当 $x_u = 1$ 时，站点 $u$ 利用边缘服务吸收了所以在该站上车的乘客所携带的感知数据，因此后续感知数据流量为0。

\begin{equation}
\label{eq:startU}
\lambda_u s (1 - x_u) = \sum_{w\in \boldsymbol{V}}f^u_{uw}, \forall u\in \boldsymbol{V}, u \neq v
\end{equation}

\textbf{（3） 成本和收益}

通过对前置站点部署边缘服务的建模与分析，可以得出边缘服务部署决策 $x_v$ 和使用 D2D 通信上传的感知数据大小之间的关系。
令 $V_{D2D}$ 表示通过 D2D 通信上传的感知数据大小， $x_v$ 和 $V_{D2D}$ 的关系如式~\eqref{Vd2d}。

\begin{equation}
\label{Vd2d}
V_{D2D} = \sum_{v\in \boldsymbol{V}}(\sum_{u\in \boldsymbol{V}}\sum_{x\in \boldsymbol{V}}f^u_{xv} x_v + \lambda_v s x_v), \forall u \neq v
\end{equation}

\subsection{优化目标}

由于边缘服务部署之后，乘客的移动设备可以使用 D2D 通信交付感知数据。
因此，在此任务 D2D 通信的成本已经涵盖在边缘服务的部署成本之内。
为了保障城市感知的传感数据完整性，本节假设没有机会通过 D2D 通信交付的感知数据，会在感知应用生命周期结束之前直接利用蜂窝网络上传。
对于每个乘客而言，利用蜂窝网络上传感知数据的成本记为$c_c$。
因此，剩余感知数据使用蜂窝网络收集的成本$C_m$可以用式~\eqref{eq:c_m} 计算。

\begin{equation}
\label{eq:c_m}
C_m = \sum_{u\in \boldsymbol{V}}c_c(\lambda_u s - \sum_{v\in \boldsymbol{V}}(\sum_{u\in \boldsymbol{V}}\sum_{x\in \boldsymbol{V}}f^u_{xv} x_v + \lambda_v s x_v))T, \forall u \neq v
\end{equation}

结合式~\eqref{eq:Cvcv}，可以得出基于公交网络的感知数据收集总成本。
再基于分析得到的限制条件和途径公交站点的流量关系，边缘服务的部署决策可以转化为如下 MILP 问题的求解：

% 现在，可以将成本最小化问题表述为
% \begin{equation}
% \min: \sum_{v\in \boldsymbol{V}}x_v c_vT+\sum_{u\in \boldsymbol{V}}c_c(\lambda_u - \max_{v\in \boldsymbol{V}} x_v \lambda'_{uv} s - \sum_{v\in \boldsymbol{V}}x_v d_{uv} s)T,\forall u \neq v
% \label{eq:origin_opt}
% \end{equation}

% 接下来，将上述优化问题线性化为混合整数线性规划（MILP），该规划通过引入辅助变量$f_{u} \leq \lambda'_{uv}, \forall u\in \boldsymbol{U}, v\in \boldsymbol{V}$形成。通过这样的定义，$f_u s$可以用来代替$\max_{v\in \boldsymbol{V}} x_v \lambda'_{uv} s$，以表示D2D可为首次到达公交车站$u$的乘客上传的最大数据速率。因此， 式~\eqref{eq:origin_opt}中的优化问题 可以等效地转换成以下形式:

\begin{equation}
\begin{aligned}
取最小值: &\quad \sum_{v\in \boldsymbol{V}}x_v c_vT \ + \\&\quad \sum_{u\in \boldsymbol{V}}c_c(\lambda_u s -  \lambda_u s x_u - \sum_{x\in \boldsymbol{V}}\sum_{v\in \boldsymbol{V}}f^u_{xv} x_v ))T, \forall u \neq v\\
\text{限制条件:} &\quad  f^u_v \leq d^u_v s, \forall u, v\in \boldsymbol{V}, u\neq v\\
% &\quad  f^u_v \geq d^u_v (1-x_v) s, \forall u, v\in V, u\neq v \\
&\quad f^u_{vw} \leq \lambda^u_{vw} s, \forall u \in \boldsymbol{V}, v \in \boldsymbol{V}, w \in \boldsymbol{V}, u \neq v\\
% &\quad f^u_{vw} \geq \lambda^u_{vw} (1-x_v) s, \forall u, v, w \in V,\\
&\quad \lambda_u s (1 - x_u) = \sum_{w\in \boldsymbol{V}}f^u_{uw}, \forall u\in \boldsymbol{V}, u \neq v\\
&\quad \sum_{x\in \boldsymbol{V}}f^u_{xv} (1-x_v) = f^u_v + \sum_{w\in \boldsymbol{V}}f^u_{vw}, \forall u\in \boldsymbol{V}, v\in \boldsymbol{V},u \neq v
%&\quad x_v \in \{0, 1\}, \forall v\in V
\end{aligned}
\label{eq:MILP}
\end{equation}

\subsection{二阶段边缘服务部署算法}

对于式~\eqref{eq:MILP} 所列出的 MILP 问题，虽然利用数学工具（例如 MATLAB、Gurobi）可以求出若干组最优解，但是求解复杂度过高，随着问题规模的扩大，求解时间呈指数级增长。
为此，本节设计了一种计算复杂度较低二阶段算法，来获得效果较好的次优解。

\textbf{第一阶段 （算法~\ref{algo_IP}）}:
在公共交通构成的有向图 $\boldsymbol{G}=<\boldsymbol{V}, \boldsymbol{E}>$ 中，单凭节点结合 $\boldsymbol{V}$ 和边集合 $\boldsymbol{E}$ 无法识别边缘服务的部署收益。
由于乘客在图中的轨迹在有向图 $\boldsymbol{G}$ 中以多个节点和边构成，所以需要依靠乘客的轨迹来确定站点是否合适部署边缘服务。
根据交通信息统计，可以获得每个乘客的乘车轨迹，借由这些轨迹可以确定感知数据在站点之间的移动顺序，以及众多感知数据的移动顺序是否存在重叠部分。
基于此，将路径划分并找出合适的站点部署边缘服务。

\begin{algorithm}[!b]
\setstretch{\algostretch}
% \KwIn{$\boldsymbol{P}$ : 乘客的路径集合}
\KwIn{$n$ 乘客总数}
\KwIn{$c_v$ 边缘服务部署成本}
\KwIn{$c_c$ 一份感知数据由蜂窝网络上传的成本}
\KwData{$\boldsymbol{P}$ 所有乘客的轨迹集合, $\boldsymbol{Stations}$ 所有车站集合 }
\For{$p \in P$}{
  \If {$p \not\in \boldsymbol{IP}$}{
    将路径 $p$ 加入集合$\boldsymbol{IP}$\\
    计使用 1 次
  }
  \Else{
    在 $\boldsymbol{IP}$ 中找到 p 的使用次数\\
    使用次数加 1
  }
}
\For{$s \in \boldsymbol{Stations}$}{
  \For{$p \in \boldsymbol{IP}$}{
    \If{$s \in p$}{
      在 $s$ 站点部署边缘服务收集感知数据的数量进行累加\\
      总和记为 $s.data$
    }
  }
  \If{$ s.data > c_v/c_c$}{
    把 $s$ 添加到 $\boldsymbol{ChoiceSet}$
  }
}
\KwOut{$\boldsymbol{ChoiceSet}$}
\caption{筛选可部署服务的站点集合 $\boldsymbol{ChoiceSet}$}
\label{algo_IP}
\end{algorithm}

在算法~\ref{algo_IP}中，另公共交通中的乘客总数为 $n$。
对于任一乘客 $i$ 而言，其移动的轨迹路径用 $p_i$ 表示。
因此，可以得到所有乘客的轨迹集合 $\boldsymbol{P}$（$p_i \in \boldsymbol{P}$）。
由于不同的乘客可能存在同样的轨迹，可以统计出每条路径 $p_i$ 上做经过的乘客数量。
将路径和其对应的乘客数量以键值对的形式保存在集合 $\boldsymbol{IP}$ （$(p_i, count) \in \boldsymbol{IP}$）中。
在不考虑边缘服务部署之间的影响时，集合 $\boldsymbol{IP}$ 可以很快得出在某一路径上部署边缘服务的感知数据收集总量。
同时，由于 $p_i$ 中包含该路径的站点信息，因此对于任意一个站点，也能快速计算仅在该站点部署边缘服务时的感知数据收集总量。

由于边缘服务的部署成本为 $c_v$，一份感知数据借由蜂窝网络上传的成本是  $c_c$。
因此，若一个站点部署边缘服务之后利用 D2D 通信收集到的感知数据总数小于 $c_v/c_c$ 时，可以看做在该站点部署边缘服务的收益为负。
所以通过统计单个站点利用 D2D 收集的感知数据大小，来建立可选站点的集合 $\boldsymbol{ChoiceSet}$。


% 式~\eqref{eq:MILP} 是MILP形式，被广泛认为是NP难，因此不可能在多项式时间内解决。当问题规模较大时，使用通过求解式~\eqref{eq:origin_opt} 得到的解是不可行的，尽管可以通过各种MILP求解器获得最优解，例如Gurobi。为了使该算法实用，将设计一种低计算复杂度的算法，该算法能够以可接受的计算复杂度逼近最优解。为此，设计了一个两阶段算法，介绍如下。

% 阶段1 (算法1 ) :由于公共交通中的乘客数量非常大，不可能直接解决最佳边缘服务安置位置。因为公交路线是乘客的一种社交图，使用乘客的路径来确定边缘服务的位置。从交通统计数据中，可以得到每个乘客的轨迹。跟踪路径由乘客经过的车站的顺序列表表示。然后，通过交通统计数据可以找到具有相同轨迹的乘客。如果跟踪路径中有一个车站部署了边缘服务来获取数据，所有沿着该跟踪路径行驶的乘客都可以更新他们的传感数据

\begin{algorithm}[!b]
\setstretch{\algostretch}
\KwIn{$n$ : 乘客数量}
\KwIn{$\boldsymbol{IP}$ : 乘客的路径统计信息}
\KwIn{$\boldsymbol{ChoiceSet}$ : 可部署边缘服务的站点集合}
\KwIn{$c_c$: 一份感知数据由蜂窝网络上传的成本}
\KwIn{$c_v$: 边缘服务部署成本}
% \KwIn{$\es$ : 『解释说明』}
% \KwData{『输入数据』}
令 $s_{sum}$ 表示部署边缘服务的数量\\
令 $min_s$ 表示可部署边缘服务的最小数量\\
$min_s$ = $\boldsymbol{ChoiceSet}$元素个数和 $n \times c_c/c_v$ 之间的最小值\\
令 $V_{D2D}$ 表示利用边缘服务能收集到的感知数据数量\\
令 $V_v$ 表示站点 $v$ 部署边缘服务后能收集到的感知数据数量\\
令 $P_v$ 表示 $\boldsymbol{IP}$ 中经过站点 $v$ 所处的路径数量\\
对 $\boldsymbol{IP}$ 中的站点按照 $V_v$/$P_v$ 的值从大到小排序\\
取出 $\boldsymbol{ChoiceSet}$ 中第一个站点\\
更新剩下站点可收集的感知数据数量，对 $\boldsymbol{ChoiceSet}$ 排序\\
令新的站点可接受感知数据数量为 $V'_v$\\
\While{$n - V_{D2D} > (c_v / c_c)$}{
  \While{$V'_v \leq (c_v / c_c)$}{
    \If {$\boldsymbol{ChoiceSet}$ 拥有一个以上的元素}{
      删掉当前 $\boldsymbol{ChoiceSet}$ 中首元素
    }
    \Else{
      回溯，撤销上一次选择
    }
  }
  \While{$V'_v > (c_v / c_c)$} {
    取出 $\boldsymbol{ChoiceSet}$ 中第一个站点\\
    更新剩下站点可收集的感知数据数量，对 $\boldsymbol{ChoiceSet}$ 排序\\
    令新的站点可接受感知数据数量为 $V'_v$\\
  }
}
\KwOut{站点选择集合}
\caption{找出合适的站点集合}
\label{algo_choice}
\end{algorithm}

\textbf{第二阶段 （算法~\ref{algo_choice}）}:
在第一阶段算法中，集合 $\boldsymbol{ChoiceSet}$ 中记录的都为收益符合要求的站点。
因此，算法~\ref{algo_choice}的最终目标就是在集合 $\boldsymbol{ChoiceSet}$ 中找出合适的站点组合，使感知数据的收集总成本最小。
在最坏的情况下，所有的感知数据均使用蜂窝网络上传，此时对应的数据收集成本为 $c_c \cdot n$。
而引入边缘服务的宗旨，就是降低感知数据收集的成本开销。
因此，边缘服务的部署数量不应超过 $n\times c_c / c_v$。

同时，为了尽可能减少边缘服务部署决策之间的相互影响，应当优先使用被较少路径穿过、但乘客流量较大的站点。
由于这类站点只有少量路径经过，因此可以避免其部署边缘服务后，对其它站点部署收益的影响。
利用动态规划的思想，每次选择一个站点做为边缘服务的部署位置时，对后续的感知数据收集情况进行迭代运算，然后按照同样的方法对站点继续排序。
如此迭代下去，可以获得一组站点选择结合，作为边缘服务的部署参考。
但是，在满足边缘服务收集感知服务的收益同时，最后依赖蜂窝网络传输的数据量可能会大于 $c_v / c_c$。
此时，算法~\ref{algo_choice}进行回溯，寻找额外的解，通过次优组合寻找是否存在让更少的感知数据使用蜂窝网络上传的边缘服务部署方法。

% :在算法1中，具有足够收入的一组站点被表示为$ChoiceSet$。算法2是找出合理的站点组合，以最小的成本收集所有感测数据。由于具有边缘服务的站的总数有限，并且只能在集合 $ChoiceSet$中选择这些站，所以选择的站的组合被限制在小范围内。在$IP$的帮助下，通过 $ChoiceSet$中选定站点获取的数据非常有效。在知道通过D2D通信上传的数据量后，可以得到不同放置解决方案的总体数据获取成本。最后，与最低成本相对应的站点组合是最佳的边缘服务放置解决方案。当选择多个站点部署边缘服务时，冗余数据也可以通过 $IP$来计算。由于蜂窝通信的成本被称为 $c_c$，在一个站部署边缘服务的成本被称为$c_v$，具有边缘服务的站的数量不超过 $n\times c_c / c_v$。同时，在数据采集量小于$c_v/c_c$的站上部署边缘服务也是不值得的。这两个条件指定了具有边缘服务的站点数量的上限。



% \textbf{『以下内容需要修改』}





% 为了确保传感数据的及时性，采集的传感数据必须及时上传和处理。通常，众包应用程序具有一定的生命周期$T$，在此周期内，必须完成整个过程，即感测、通信和处理。乘客可以通过D2D通信将感测数据上传到部署有数据处理服务的公交车站，或者通过蜂窝通信上传到云。假设在公交车站持续时间内，所有感测数据都可以通过D2D通信成功上传。通过D2D通信不会产生通信费用，在蜂窝通信的情况下，每数据单元收取$c_c$。尽管在公交车站启用数据处理时，公交车站必须部署相应的边缘计算服务，这与云中的服务相同。在网络边缘部署众包数据处理服务并不是免费的，边缘服务每单位时间收费$c_v$。

% \subsection{用于群体数据处理的边缘服务}

% 由于大多数移动设备具有多种通信手段，这些移动设备可以通过D2D无线通信技术(例如蓝牙、WiFi )或长途无线通信(例如蜂窝网络)与其他移动设备交换数据。利用D2D无线通信，数据交换和能耗的成本大大低于长途无线通信。在公交车站部署边缘服务后，乘客可以在这些车站等候时将传感数据发送给这些服务器。如果一些车站没有部署边缘服务，则从这些车站出发的乘客可以在通过带有边缘服务的车站时上传他们的感测数据。一般来说，来自一名乘客的这些感测数据量并不太大，当公交车停在有边缘服务的车站时，上传的时间就足够了。

% 另一方面，公交车站容纳了大量的人。这意味着部署在公交车站的边缘服务可以获取大量传感数据。这些站点是预处理传感数据的最佳场所，例如冗余消除、数据挖掘、数据学习。借助边缘服务，主干网和云服务的过载可以大大减少。与此同时，由于这些边缘服务在地理上更接近乘客，因此自然可以减少服务的延迟。但是，在所有公交车站部署边缘服务是不现实的。如何部署边缘服务是一个紧迫的挑战。








\section{实验结果与分析}

为了验证问题公式和两阶段算法，本节中的时延基于模拟测试。
在模拟的同时，还比较了不同边缘服务放置解决方案，以证明在智慧城市应用中，本章提出的两阶段算法是在公交网络中部署边缘服务的最佳方法。

\textbf{『还要加入补充实验，在补做实验』}

\subsection{公共交通模拟平台}


为了回放乘客等候、乘车、到达和上传数据的行为，本节建立了一个公共交通模拟平台（Bus Traffic Simulation Platform，简称 BSTP）来模拟一个城市的交通行为。BTSP的主要输入可分为两部分。

输入的第一部分是城市的公共汽车时刻表，第二部分是每个乘客的路线。从公共汽车时刻表中，可以得到所有公交汽车的过往路线、到达时间和出发间隔。此外，可以立即生成交通有向图。输入的第二部分是每个乘客的路线，其中包含所有乘客的信息，每个乘客的起点站和终点站。对于每个乘客，都有几种可用的路径来满足乘客的需求。然后，按照可用路径构建一个乘车计划列表，然后按时间成本对列表进行排序。因此乘客可以优先选择时间成本最小的乘坐计划。

通过输入的两个部分数据，BTSP知道一辆公共汽车是否停在车站。如果一辆公交车在车站，公交车上的乘客可以按照他们的乘车计划下车，车站的乘客可以决定是否上车。与此同时，如果这个站点已经部署了边缘服务，公交车内、或者站台上的乘客可以在站点利用 D2D 通信上传感知数据。利用 BTSP 模拟，可以完整回放交通过程和数据上传过程。

\subsection{不同边缘服务部署策略的成本开销}

在BTSP中，按照实际公交时间表在武汉市试验了30条公交线路。BTSP共有273个站点，241个公共汽车在60分钟内从7:00到8:00运行。公交线路图如图~\ref{Figure_test_bus_lines} 所示，所有公交线路用绿色高亮显示。在这种情况下，假设众包应用程序有60分钟的特定生命周期，边缘服务只能部署在公交车站。在车站部署边缘服务的成本是每小时500($c_v = 500$)。通过蜂窝网络上传一段数据的成本是1 ($c_c = 1$)。

\begin{figure}[!h]
  \centering
  % \vspace{-1em}
  \includegraphics[width=300pt]{figures/Sec_MONET/test_bus_lines.png}
  \vspace{-0.5em}
  \caption{模拟测试中使用的公交路线}
  % \vspace{-1em}
  \label{Figure_test_bus_lines}
\end{figure}

遵循前文描述的系统模型，使用Gurobi找出边缘服务的最佳放置解决方案。与本文中的两阶段算法相比，构建了另外两种不同的布局策略。第一种算法是根据人员流动（Flow of People）选择站点来部署边缘服务。第二种算法是根据站点的连接度（Connectivity of Station）进行并选择部署边缘服务。由于交通的繁忙程度随着时间不同，所以在BTSP中使用不同数量的乘客进行不同时段的交通模拟。

当乘客量设置为5000、10000和50000时，BTSP中的结果如图~\ref{fig_5000}、图~\ref{fig_10000} 和图~\ref{fig_50000} 所示。由于$c_c$设置为1，最大成本等于乘客人数。在图~\ref{fig_5000} (a)、图~\ref{fig_10000} (a)和图~\ref{fig_50000} (a)中，结果表明，的两阶段算法可以找到一个更好的布局解决方案，以最小化成本，这类似于Gurobi找到的最佳解决方案。然而，FoP和CoS放置策略的性能不令人满意，它们的部署成本比最佳放置策略高出20\%。比较FoP和CoS的放置策略，它们的成本非常接近。因此，按照人员流动或站点连接部署边缘服务不是节省成本的有效方法。

\begin{figure}[!h]
  \centering
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/cost5000.pdf}
    \label{fig_cost5000}
    \vspace{-2em}
    \caption{不同部署策略的数据s收集成本}
  \end{subfigure}
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/data5000.pdf}
    \label{fig_data5000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集数量}
  \end{subfigure}
    \vspace{-0.5em}
    \caption{5000 名乘客在 BSTP 中的模拟结果}
  \label{fig_5000}
\end{figure}

\begin{figure}[!h]
  \centering
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/cost10000.pdf}
    \label{fig_cost10000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集成本}
  \end{subfigure}
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/data10000.pdf}
    \label{fig_data10000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集数量}
  \end{subfigure}
    \vspace{-0.5em}
    \caption{10000 名乘客在 BSTP 中的模拟结果}
  \label{fig_10000}
\end{figure}

\begin{figure}[!h]
  \centering
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/cost50000.pdf}
    \label{fig_cost50000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集成本}
  \end{subfigure}
  \begin{subfigure}[b]{0.45\linewidth}
    \includegraphics[width=200pt]{./figures/Sec_MONET/data50000.pdf}
    \label{fig_data50000}
    \vspace{-2em}
    \caption{不同部署策略的数据收集数量}
  \end{subfigure}
    \vspace{-0.5em}
    \caption{50000 名乘客在 BSTP 中的模拟结果}
  \label{fig_50000}
\end{figure}

在数据采集中，每条数据都有固定的体积，等于$s$。由于所有乘客都必须上传他们的传感数据，所以收集的数据总量是乘客人数乘以$s$。如图~\ref{fig_5000} (b)、图~\ref{fig_10000} (b)、图~\ref{fig_50000} (b)所示，当成本较低时，D2D通信上传的数据变得更多。当边缘服务按照FoP策略和CoS策略部署时，D2D通信上传的数据显著减少。

在评估之前，已经告知60分钟内有241辆公共汽车在行驶。公共汽车的最大载客量设定为50人。在这个模拟场景中，5000名乘客造成较轻的交通负载，10000名乘客几乎交通满载，50000名乘客造成交通过载。结果显示，当交通负载接近满时，通过D2D通信上传的数据比例变得最大。相反，当交通负载太重或太轻时，通过D2D通信上传的数据量将变得更小。当交通负载较轻时，交通流量的减少会导致不经济的布局决策。当交通负载很重时，大量乘客将滞留在起点站或中转站。如果这个车站没有部署边缘服务，严重阻碍乘客通过D2D通信上传数据。

\section{本章小结}

本章主要研究了城市范围内的移动群智感知应用中的数据收集过程。
通过在公交车站部署边缘服务，利用城市居民的社会活动来完成感知数据的收集工作，以达到充分利用 D2D 通信，降低数据收集成本的目的。
本章围绕感知应用的生命周期、感知质量要求以及边缘服务部署策略，构建了 MILP 模型。
然后通过动态规划算法决定边缘服务的部署策略。
经仿真测试对比，该算法解决了交叉路径中感知数据的重复收集问题，提高 D2D 通信利用率并减少蜂窝网络通信的使用，降低了城市感知中数据收集的总成本。

